
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html><body><div class="banner"><a href="../index.html"><img alt="Logo" class="logo" src="../logo.png" style="float:right" width="200"/></a></div><html><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--

                    This HTML was auto-generated from MATLAB code.
                    To make changes, update the MATLAB code and republish this document.
                --><title>Invariance - the key feature for model reduction</title><meta content="MATLAB 9.14" name="generator"/><link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/><meta content="2023-09-07" name="DC.date"/><meta content="InvarianceProperty.m" name="DC.source"/><style type="text/css">
            html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

            html { min-height:100%; margin-bottom:1px; }
            html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
            html body td { vertical-align:top; text-align:left; }

            h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
            h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
            h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

            a { color:#005fce; text-decoration:none; }
            a:hover { color:#005fce; text-decoration:underline; }
            a:visited { color:#004aa0; text-decoration:none; }

            p { padding:0px; margin:0px 0px 20px; }
            img { padding:0px; margin:0px 0px 20px; border:none; }
            p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

            ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
            ul li { padding:0px; margin:0px 0px 7px 0px; }
            ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
            ul li ol li { list-style:decimal; }
            ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
            ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
            ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
            ol li ol li { list-style-type:lower-alpha; }
            ol li ul { padding-top:7px; }
            ol li ul li { list-style:square; }

            .content { font-size:1.2em; line-height:140%; padding: 20px; }

            pre, code { font-size:12px; }
            tt { font-size: 1.2em; }
            pre { margin:0px 0px 20px; }
            pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
            pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
            pre.error { color:red; }

            @media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

            span.keyword { color:#0000FF }
            span.comment { color:#228B22 }
            span.string { color:#A020F0 }
            span.untermstring { color:#B20000 }
            span.syscmd { color:#B28C00 }
            span.typesection { color:#A0522D }

            .footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
            .footer p { margin:0px; }
            .footer a { color:#878787; }
            .footer a:hover { color:#878787; text-decoration:underline; }
            .footer a:visited { color:#878787; }

            table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
            table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }

            .center {
                display: block;
                margin-left: auto;
                margin-right: auto;
                width: 50%;
              }



        </style></head><body><div class="content"><h1>Invariance - the key feature for model reduction</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">Projection based ROM</a></li><li><a href="#3">ROM on Spectral Submanifold (SSM)</a></li><li><a href="#10">Effect of perturbations</a></li></ul></div><p>Consider a dynamical system of the form (due to George Haller)</p><p><span class="MathJax_Preview"><img alt="$$\dot{x} = -\frac{1}{\sqrt{11}}x +xy +x^3$$" src="InvarianceProperty_eq09844023221705894465-Rescaled.png" style="width: 128.4px; height: auto;"/></span><script type="math/tex">\dot{x} = -\frac{1}{\sqrt{11}}x +xy +x^3</script></p><p><span class="MathJax_Preview"><img alt="$$\dot{y} = -y -2x^2$$" src="InvarianceProperty_eq11583251637150989750-Rescaled.png" style="width: 76.8px; height: auto;"/></span><script type="math/tex">\dot{y} = -y -2x^2</script></p><p>The linear part of the system reads</p><p><span class="MathJax_Preview"><img alt="$$\dot{y} = -y$$" src="InvarianceProperty_eq14387737990420241131-Rescaled.png" style="width: 42.0px; height: auto;"/></span><script type="math/tex">\dot{y} = -y</script></p><p><span class="MathJax_Preview"><img alt="$$\dot{x} = -\frac{1}{\sqrt{11}}x$$" src="InvarianceProperty_eq02834420995018937566-Rescaled.png" style="width: 70.8px; height: auto;"/></span><script type="math/tex">\dot{x} = -\frac{1}{\sqrt{11}}x</script></p><p>and has an asymptotically stable fixed point at <span class="MathJax_Preview"><img alt="$(x,y)=0$" src="InvarianceProperty_eq12488938018268807919-Rescaled.png" style="width: 54.0px; height: auto;"/></span><script type="math/tex">(x,y)=0</script>. The spectral subspaces</p><p><span class="MathJax_Preview"><img alt="$$E_x := \{(x,y) \in  \mathbf{R} ^2 , y = 0 \}$$" src="InvarianceProperty_eq02036768928621554389-Rescaled.png" style="width: 150.0px; height: auto;"/></span><script type="math/tex">E_x := \{(x,y) \in  \mathbf{R} ^2 , y = 0 \}</script></p><p><span class="MathJax_Preview"><img alt="$$E_y := \{(x,y) \in  \mathbf{R}^2 , x = 0 \}$$" src="InvarianceProperty_eq10586113195697036605-Rescaled.png" style="width: 151.2px; height: auto;"/></span><script type="math/tex">E_y := \{(x,y) \in  \mathbf{R}^2 , x = 0 \}</script></p><p>are invariant under the flow of this linear dynamical system.</p><h2 id="2">Projection based ROM</h2><p>In order to produce a ROM for the <span class="MathJax_Preview"><img alt="$x$" src="InvarianceProperty_eq16247206711595679522-Rescaled.png" style="width: 7.199999999999999px; height: auto;"/></span><script type="math/tex">x</script> coordinate one might thus opt to project the system equations onto <span class="MathJax_Preview"><img alt="$E_x$" src="InvarianceProperty_eq05569007377996954769-Rescaled.png" style="width: 14.399999999999999px; height: auto;"/></span><script type="math/tex">E_x</script>, as any trajectory on it is also a trajectory of the full linear system. As a resulting model one obtains</p><p><span class="MathJax_Preview"><img alt="$$\dot{x} = x(-\frac{1}{\sqrt{11}}+x^2)$$" src="InvarianceProperty_eq10928735662411609669-Rescaled.png" style="width: 109.2px; height: auto;"/></span><script type="math/tex">\dot{x} = x(-\frac{1}{\sqrt{11}}+x^2)</script></p><p>Thus, from the projected equations we would conclude that the full system has three fixedpoints,</p><p><span class="MathJax_Preview"><img alt="$$x_1= -\frac{1}{11^{1/4}},\quad x_2=0,  \quad x_3=\frac{1}{11^{1/4}}$$" src="InvarianceProperty_eq11632588520287697985-Rescaled.png" style="width: 206.4px; height: auto;"/></span><script type="math/tex">x_1= -\frac{1}{11^{1/4}},\quad x_2=0,  \quad x_3=\frac{1}{11^{1/4}}</script></p><p>For this simple model we can, howerver, try to verify these results directly via the full dynamical system. We set <span class="MathJax_Preview"><img alt="$\dot{x}=0, \dot{y}=0$" src="InvarianceProperty_eq04680869788070127947-Rescaled.png" style="width: 68.39999999999999px; height: auto;"/></span><script type="math/tex">\dot{x}=0, \dot{y}=0</script> and get</p><p><span class="MathJax_Preview"><img alt="$$0 = x(\frac{1}{\sqrt{11}}+x^2)$$" src="InvarianceProperty_eq05895920992862484164-Rescaled.png" style="width: 97.2px; height: auto;"/></span><script type="math/tex">0 = x(\frac{1}{\sqrt{11}}+x^2)</script></p><p>So the full system only has a <b>single fixedpoint</b> at <span class="MathJax_Preview"><img alt="$x=0$" src="InvarianceProperty_eq04399950071080211931-Rescaled.png" style="width: 31.2px; height: auto;"/></span><script type="math/tex">x=0</script>. Indeed, as shown in the following figure, the ROM clearly does not describe the full system behaviour.</p><p><img alt="" hspace="5" src="ProjectedROM.png" style="width:30%;" vspace="5"/> </p><p>So what went wrong?</p><p>The key feature that our method is missing is the <b>invariance</b> property. A set is called invariant, if all trajectories that start in it, remain confined to it for all times. So these invariant sets can be considered independently of the remaining dynamical system. Any dynamics that are observed in an invariant set also exist in the full system.</p><p><span class="MathJax_Preview"><img alt="$E_x$" src="InvarianceProperty_eq05569007377996954769-Rescaled.png" style="width: 14.399999999999999px; height: auto;"/></span><script type="math/tex">E_x</script> is not an invariant subspace for the full nonlinear dynamical system. Indeed, take any point <span class="MathJax_Preview"><img alt="$(x,0)$" src="InvarianceProperty_eq10845053814281448031-Rescaled.png" style="width: 28.799999999999997px; height: auto;"/></span><script type="math/tex">(x,0)</script> in <span class="MathJax_Preview"><img alt="$E_x$" src="InvarianceProperty_eq05569007377996954769-Rescaled.png" style="width: 14.399999999999999px; height: auto;"/></span><script type="math/tex">E_x</script> and plug it into the full ODE. Due to the coupling terms, there is a finite contribution to the flow in <span class="MathJax_Preview"><img alt="$y$" src="InvarianceProperty_eq14521328786523663806-Rescaled.png" style="width: 7.199999999999999px; height: auto;"/></span><script type="math/tex">y</script> direction via</p><p><span class="MathJax_Preview"><img alt="$$\dot{y}_{\textrm{nl}} = -2x^2$$" src="InvarianceProperty_eq14278901317275167132-Rescaled.png" style="width: 64.8px; height: auto;"/></span><script type="math/tex">\dot{y}_{\textrm{nl}} = -2x^2</script></p><p>which immediately pushes the trajectory out of <span class="MathJax_Preview"><img alt="$E_x$" src="InvarianceProperty_eq05569007377996954769-Rescaled.png" style="width: 14.399999999999999px; height: auto;"/></span><script type="math/tex">E_x</script>. The trajectories of the projected dynamical system on <span class="MathJax_Preview"><img alt="$E_x$" src="InvarianceProperty_eq05569007377996954769-Rescaled.png" style="width: 14.399999999999999px; height: auto;"/></span><script type="math/tex">E_x</script> thus are not trajectories of the full system and indeed even the qualitative behaviour is very different, even exhibiting artificial fixed points.</p><p>So when using projective ROMs even ignoring a single DOF can lead to erroneous results with fictitious fixedpoints. In order to avoid these problems and for rigorous and exact model reduction, the modelling subspace thus has to be invariant. In the context of nonlinear dynamical system, the objects which fulfill this property are invariant manifolds, which perturb from the linear spectral subspaces when nonlinearities are added to a linear dynamical system.</p><p>Even ignoring a single mode can lead to completely erronous conclusions when using projection based techniques for model reduction, as shown in this example!</p><h2 id="3">ROM on Spectral Submanifold (SSM)</h2><p>We now proceed to construct a ROM on the unique smoothest invariant manifold (SSM), which is nonlinear and perturbs smoothly from <span class="MathJax_Preview"><img alt="$E_x$" src="InvarianceProperty_eq05569007377996954769-Rescaled.png" style="width: 14.399999999999999px; height: auto;"/></span><script type="math/tex">E_x</script>. For this we set</p><p><span class="MathJax_Preview"><img alt="$$\mathbf{z} = \left[ \begin{array}{c}  x \\ y \end{array}\right], \quad \mathbf{A}
=\left[ \begin{array}{c}  -1/\sqrt{11} \quad 0 \\ 0 \quad -1 \end{array}\right],
\quad \mathbf{B=1}, \quad \mathbf{F(z)} = \left[ \begin{array}{c}  xy + x^3
\\ -2x^2 \end{array}\right],$$" src="InvarianceProperty_eq13665746125602271037-Rescaled.png" style="width: 400.8px; height: auto;"/></span><script type="math/tex">\mathbf{z} = \left[ \begin{array}{c}  x \\ y \end{array}\right], \quad \mathbf{A}
=\left[ \begin{array}{c}  -1/\sqrt{11} \quad 0 \\ 0 \quad -1 \end{array}\right],
\quad \mathbf{B=1}, \quad \mathbf{F(z)} = \left[ \begin{array}{c}  xy + x^3
\\ -2x^2 \end{array}\right],</script></p><pre class="codeinput">clear <span class="string">DS</span> <span class="string">S</span>
A = [-1/sqrt(11) 0 ; 0 , -1];
B = eye(2);

Fnl(2).coeffs = [1 0; 0,-2];
Fnl(2).ind = [1,1 ; 2,0];

Fnl(3).coeffs = [1;0];
Fnl(3).ind    = [3,0];
        </pre><p>Now we create an instance of the dynamical system class</p><pre class="codeinput">DS = <a href="../Library/DynamicalSystem/DynamicalSystem.html">DynamicalSystem</a>();
set(DS,<span class="string">'A'</span>,A,<span class="string">'B'</span>,B,<span class="string">'F'</span>,Fnl);
set(DS.<a href="../Library/Features/Options/Options.html">Options</a>,<span class="string">'notation'</span>,<span class="string">'multiindex'</span>); <span class="comment">% Use multi-index notation</span>
        </pre><p>A Linear Modal analysis sets up the stage for the SSM computation.</p><pre class="codeinput">[V,D,W] = DS.<a href="../Library/DynamicalSystem/linear_spectral_analysis.html">linear_spectral_analysis</a>();
        </pre><pre class="codeoutput">
 The first 2 nonzero eigenvalues are given as 
   -0.3015
   -1.0000

</pre><p>We choose to construct a ROM on the invariant manifold tangent to <span class="MathJax_Preview"><img alt="$E_x$" src="InvarianceProperty_eq05569007377996954769-Rescaled.png" style="width: 14.399999999999999px; height: auto;"/></span><script type="math/tex">E_x</script>. Thus we choose the first mode to be the master mode.</p><pre class="codeinput">S = <a href="../Library/SSM/SSM.html">SSM</a>(DS);
set(S.<a href="../Library/Features/Options/Options.html">Options</a>,<span class="string">'reltol'</span>,0.1,<span class="string">'notation'</span>,<span class="string">'multiindex'</span>)
masterModes = 1;                        <span class="comment">% master mode</span>
order = 10;                              <span class="comment">% SSM expansion order</span>
S.<a href="../Library/Manifold/choose_E.html">choose_E</a>(masterModes);
        </pre><pre class="codeoutput">No (near) outer resonances detected in the (truncated) spectrum
sigma_out = 3
No (near) inner resonances detected in the (truncated) spectrum
sigma_in = 3
</pre><p>As no resonances between the master and restricted modes are detected, the existence and uniqueness of the SSM is guaranteed. The spectral quotient is <span class="MathJax_Preview"><img alt="$\sigma_{\textrm{out}}=3$" src="InvarianceProperty_eq18261246633386023804-Rescaled.png" style="width: 51.6px; height: auto;"/></span><script type="math/tex">\sigma_{\textrm{out}}=3</script>, which implies that pushing the approximation past order 3 guarantees that the computed manifold corresponds to the primary SSM which is sought. We thus may continue with the computation and compute the autonomous SSM.</p><pre class="codeinput">[W0,R0] = S.<a href="../Library/Manifold/compute_whisker.html">compute_whisker</a>(order);     <span class="comment">% compute of SSM</span>
        </pre><pre class="codeoutput">Manifold computation time at order 2 = 00:00:00
Estimated memory usage at order  2 = 5.36E-03 MB
Manifold computation time at order 3 = 00:00:00
Estimated memory usage at order  3 = 5.70E-03 MB
Manifold computation time at order 4 = 00:00:00
Estimated memory usage at order  4 = 6.08E-03 MB
Manifold computation time at order 5 = 00:00:00
Estimated memory usage at order  5 = 6.49E-03 MB
Manifold computation time at order 6 = 00:00:00
Estimated memory usage at order  6 = 6.94E-03 MB
Manifold computation time at order 7 = 00:00:00
Estimated memory usage at order  7 = 7.41E-03 MB
Manifold computation time at order 8 = 00:00:00
Estimated memory usage at order  8 = 7.91E-03 MB
Manifold computation time at order 9 = 00:00:00
Estimated memory usage at order  9 = 8.45E-03 MB
Manifold computation time at order 10 = 00:00:00
Estimated memory usage at order  10 = 9.01E-03 MB
</pre><p>Now, to get better understanding of the invariance property, we create a visualisation of the unstable SSM. For this we choose a set of parametrisation coordinates which are mapped to the full phase space of the dynamical system.</p><pre class="codeinput"><span class="comment">% Dynamics on SSM</span>
lamdMaster = D(masterModes,masterModes);
t  = linspace(0,20,100);
p1 = 0.25*exp(lamdMaster*t);
p2 = -0.25*exp(lamdMaster*t);

<span class="comment">% mapping to full system</span>
z1 = <a href="../Library/Features/misc/reduced_to_full_traj.html">reduced_to_full_traj</a>(t,p1,W0);
z2 = <a href="../Library/Features/misc/reduced_to_full_traj.html">reduced_to_full_traj</a>(t,p2,W0);
z  = [z1 z2(:,end:-1:1)];

<span class="comment">% plot SSM</span>
h = figure;
plot(z(1,:),z(2,:),<span class="string">'-'</span>,<span class="string">'LineWidth'</span>,1.5,<span class="string">'Color'</span>,<span class="string">"#77AC30"</span>);
xlabel(<span class="string">'x'</span>); ylabel(<span class="string">'y'</span>);
set(gca,<span class="string">'fontsize'</span>,16); set(gca,<span class="string">'LineWidth'</span>,1.5);
grid <span class="string">on</span>;box <span class="string">on</span>;hold <span class="string">on</span>;axis <span class="string">tight</span>;
legend(<span class="string">'SSM $\mathcal{O}(10)$'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);
        </pre><img alt="" hspace="5" src="InvarianceProperty_01.png" vspace="5"/> <p>Next we empirically verify the invariance of the SSM. For this we choose an initial condition on the SSM, and apply the flow of the full dynamical system. Then this condition is perturbed and the evolution of nearby trajectories is studied.</p><p>As the SSM is computed as a series expansion, it is local in nature. Pushing the approximation to higher orders, the degree of convergence of the approximation to the SSM gets better and better. As a consequence of this expansion, the approximation of the SSM is closer to the actual SSM, the closer to the origin one observes it. Thus, to showcase the invariance of the SSM, we have chosen to map it to the full space in a small region around the fixed point of interest. To decrease the invariance error higher order expansions of the SSM can be sought.</p><pre class="codeinput">z0 = z(:,2);
plot(z0(1),z0(2),<span class="string">'bx'</span>,<span class="string">'MarkerSize'</span>,10)
odefun = @(t,x) DS.<a href="../Library/DynamicalSystem/odefun.html">odefun</a>(t,x);
[t0, x0] = ode45(odefun, [0,10], z0);
plot(x0(:,1),x0(:,2),<span class="string">'b-'</span>,<span class="string">'LineWidth'</span>,1.5); grid <span class="string">on</span>
legend(<span class="string">'SSM $\mathcal{O}(10)$'</span>, <span class="string">'Full system trajectory'</span>,<span class="string">''</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>)
        </pre><img alt="" hspace="5" src="InvarianceProperty_02.png" vspace="5"/> <h2 id="10">Effect of perturbations</h2><pre class="codeinput">perturbations = {[-0.0125;0], [-0.025;0], [0.025;0], [0.0125;0]};
<span class="keyword">for</span> i = 1:4
    z0 = z(:,2) + perturbations{i};
    plot(z0(1),z0(2),<span class="string">'bx'</span>,<span class="string">'MarkerSize'</span>,10)
    odefun = @(t,x) DS.<a href="../Library/DynamicalSystem/odefun.html">odefun</a>(t,x);
    [t0, x0] = ode45(odefun, [0,10], z0);
    plot(x0(:,1),x0(:,2),<span class="string">'b-'</span>,<span class="string">'LineWidth'</span>,1.5); grid <span class="string">on</span>
<span class="keyword">end</span>
legend(<span class="string">'SSM $\mathcal{O}(10)$'</span>, <span class="string">'Full system trajectories'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>)
        </pre><img alt="" hspace="5" src="InvarianceProperty_03.png" vspace="5"/> <p>Note how the trajectories which are launched away from the manifold decay to it as they approach the fixedpoint. Due to the invariance of the manifold, orbits on the manifold correspond to orbits of the full dynamical system which makes the ROM exact.</p><p class="footer"><br/><a href="https://www.mathworks.com/products/matlab/">Published with MATLABÂ® R2023a</a><br/></p></div><!--
            ##### SOURCE BEGIN #####
            %% Invariance - the key feature for model reduction
%
%%
% Consider a dynamical system of the form (due to George Haller)
% 
% $$\dot{x} = -\frac{1}{\sqrt{11}}x +xy +x^3$$
% 
% $$\dot{y} = -y -2x^2$$
% 
% The linear part of the system reads
% 
% $$\dot{y} = -y$$
% 
% $$\dot{x} = -\frac{1}{\sqrt{11}}x$$
% 
% and has an asymptotically stable fixed point at $(x,y)=0$. The spectral subspaces
% 
% $$E_x := \{(x,y) \in  \mathbf{R} ^2 , y = 0 \}$$
% 
% $$E_y := \{(x,y) \in  \mathbf{R}^2 , x = 0 \}$$
% 
% are invariant under the flow of this linear dynamical system. 
%% Projection based ROM
% 
% 
% In order to produce a ROM for the $x$ coordinate one might thus opt to project 
% the system equations onto $E_x$, as any trajectory on it is also a trajectory 
% of the full linear system. As a resulting model one obtains
% 
% $$\dot{x} = x(-\frac{1}{\sqrt{11}}+x^2)$$
% 
% Thus, from the projected equations we would conclude that the full system 
% has three fixedpoints,
% 
% $$x_1= -\frac{1}{11^{1/4}},\quad x_2=0,  \quad x_3=\frac{1}{11^{1/4}}$$
% 
% For this simple model we can, howerver, try to verify these results directly 
% via the full dynamical system. We set $\dot{x}=0, \dot{y}=0$ and get
% 
% $$0 = x(\frac{1}{\sqrt{11}}+x^2)$$
% 
% So the full system only has a *single fixedpoint* at $x=0$. Indeed, as shown 
% in the following figure, the ROM clearly does not describe the full system behaviour.
% 
% <<ProjectedROM.png>>
% 
% So what went wrong?
% 
% The key feature that our method is missing is the *invariance* property. A 
% set is called invariant, if all trajectories that start in it, remain confined 
% to it for all times. So these invariant sets can be considered independently 
% of the remaining dynamical system. Any dynamics that are observed in an invariant 
% set also exist in the full system. 
% 
% $E_x$ is not an invariant subspace for the full nonlinear dynamical system. 
% Indeed, take any point $(x,0)$ in $E_x$ and plug it into the full ODE. Due to 
% the coupling terms, there is a finite contribution to the flow in $y$ direction 
% via
% 
% $$\dot{y}_{\textrm{nl}} = -2x^2$$
% 
% which immediately pushes the trajectory out of $E_x$. The trajectories of 
% the projected dynamical system on $E_x$ thus are not trajectories of the full 
% system and indeed even the qualitative behaviour is very different, even exhibiting 
% artificial fixed points.
% 
% So when using projective ROMs even ignoring a single DOF can lead to erroneous 
% results with fictitious fixedpoints. In order to avoid these problems and for 
% rigorous and exact model reduction, the modelling subspace thus has to be invariant. 
% In the context of nonlinear dynamical system, the objects which fulfill this 
% property are invariant manifolds, which perturb from the linear spectral subspaces 
% when nonlinearities are added to a linear dynamical system. 
% 
% Even ignoring a single mode can lead to completely erronous conclusions when 
% using projection based techniques for model reduction, as shown in this example!
%% ROM on Spectral Submanifold (SSM)
% We now proceed to construct a ROM on the unique smoothest invariant manifold 
% (SSM), which is nonlinear and perturbs smoothly from $E_x$. For this we set
% 
% $$\mathbf{z} = \left[ \begin{array}{c}  x \\ y \end{array}\right], \quad \mathbf{A} 
% =\left[ \begin{array}{c}  -1/\sqrt{11} \quad 0 \\ 0 \quad -1 \end{array}\right], 
% \quad \mathbf{B=1}, \quad \mathbf{F(z)} = \left[ \begin{array}{c}  xy + x^3 
% \\ -2x^2 \end{array}\right],$$
% 
% 

clear DS S 
A = [-1/sqrt(11) 0 ; 0 , -1];
B = eye(2);

Fnl(2).coeffs = [1 0; 0,-2];
Fnl(2).ind = [1,1 ; 2,0];

Fnl(3).coeffs = [1;0];
Fnl(3).ind    = [3,0];
%% 
% Now we create an instance of the dynamical system class

DS = <a href="../Library/DynamicalSystem/DynamicalSystem.html">DynamicalSystem</a>();
set(DS,'A',A,'B',B,'F',Fnl);
set(DS.<a href="../Library/Features/Options/Options.html">Options</a>,'notation','multiindex'); % Use multi-index notation
%% 
% A Linear Modal analysis sets up the stage for the SSM computation.

[V,D,W] = DS.<a href="../Library/DynamicalSystem/linear_spectral_analysis.html">linear_spectral_analysis</a>();
%% 
% We choose to construct a ROM on the invariant manifold tangent to $E_x$. Thus 
% we choose the first mode to be the master mode.

S = <a href="../Library/SSM/SSM.html">SSM</a>(DS);
set(S.<a href="../Library/Features/Options/Options.html">Options</a>,'reltol',0.1,'notation','multiindex')
masterModes = 1;                        % master mode
order = 10;                              % SSM expansion order
S.<a href="../Library/Manifold/choose_E.html">choose_E</a>(masterModes);
%% 
% As no resonances between the master and restricted modes are detected, the 
% existence and uniqueness of the SSM is guaranteed. The spectral quotient is 
% $\sigma_{\textrm{out}}=3$, which implies that pushing the approximation past 
% order 3 guarantees that the computed manifold corresponds to the primary SSM 
% which is sought. We thus may continue with the computation and compute the autonomous 
% SSM.

[W0,R0] = S.<a href="../Library/Manifold/compute_whisker.html">compute_whisker</a>(order);     % compute of SSM
%% 
% Now, to get better understanding of the invariance property, we create a visualisation  
% of the unstable SSM. For this we choose a set of parametrisation coordinates 
% which are mapped to the full phase space of the dynamical system.

% Dynamics on SSM
lamdMaster = D(masterModes,masterModes);
t  = linspace(0,20,100);
p1 = 0.25*exp(lamdMaster*t);
p2 = -0.25*exp(lamdMaster*t);

% mapping to full system
z1 = <a href="../Library/Features/misc/reduced_to_full_traj.html">reduced_to_full_traj</a>(t,p1,W0);
z2 = <a href="../Library/Features/misc/reduced_to_full_traj.html">reduced_to_full_traj</a>(t,p2,W0);
z  = [z1 z2(:,end:-1:1)];

% plot SSM
h = figure;
plot(z(1,:),z(2,:),'-','LineWidth',1.5,'Color',"#77AC30"); 
xlabel('x'); ylabel('y');
set(gca,'fontsize',16); set(gca,'LineWidth',1.5);
grid on;box on;hold on;axis tight;
legend('SSM $\mathcal{O}(10)$','Interpreter','latex');
%% 
% Next we empirically verify the invariance of the SSM. For this we choose an initial condition 
% on the SSM, and apply the flow of the full dynamical system. Then this condition 
% is perturbed and the evolution of nearby trajectories is studied.
% 
% As the SSM is computed as a series expansion, it is local in nature. Pushing 
% the approximation to higher orders, the degree of convergence of the approximation 
% to the SSM gets better and better. As a consequence of this expansion, the approximation 
% of the SSM is closer to the actual SSM, the closer to the origin one observes 
% it. Thus, to showcase the invariance of the SSM, we have chosen to map it to 
% the full space in a small region around the fixed point of interest. To decrease 
% the invariance error higher order expansions of the SSM can be sought.

z0 = z(:,2);
plot(z0(1),z0(2),'bx','MarkerSize',10)
odefun = @(t,x) DS.<a href="../Library/DynamicalSystem/odefun.html">odefun</a>(t,x);
[t0, x0] = ode45(odefun, [0,10], z0);
plot(x0(:,1),x0(:,2),'b-','LineWidth',1.5); grid on
legend('SSM $\mathcal{O}(10)$', 'Full system trajectory','','Interpreter','latex')


%% Effect of perturbations
perturbations = {[-0.0125;0], [-0.025;0], [0.025;0], [0.0125;0]};
for i = 1:4
    z0 = z(:,2) + perturbations{i};
    plot(z0(1),z0(2),'bx','MarkerSize',10)
    odefun = @(t,x) DS.<a href="../Library/DynamicalSystem/odefun.html">odefun</a>(t,x);
    [t0, x0] = ode45(odefun, [0,10], z0);
    plot(x0(:,1),x0(:,2),'b-','LineWidth',1.5); grid on
end
legend('SSM $\mathcal{O}(10)$', 'Full system trajectories','','','','','Interpreter','latex')
%% 
% Note how the trajectories which are launched away from the manifold decay 
% to it as they approach the fixedpoint. Due to the invariance of the manifold, 
% orbits on the manifold correspond to orbits of the full dynamical system which 
% makes the ROM exact.

            ##### SOURCE END #####
        --></body></html></body></html>