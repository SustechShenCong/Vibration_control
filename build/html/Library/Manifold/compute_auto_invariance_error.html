
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html><body><div class="banner"><a href="../../index.html"><img alt="Logo" class="logo" src="../../logo.png" style="float:right" width="200"/></a></div><html><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--

                    This HTML was auto-generated from MATLAB code.
                    To make changes, update the MATLAB code and republish this document.
                --><title>COMPUTE AUTO INVARIANCE ERROR</title><meta content="MATLAB 9.14" name="generator"/><link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/><meta content="2023-09-09" name="DC.date"/><meta content="compute_auto_invariance_error.m" name="DC.source"/><style type="text/css">
            html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

            html { min-height:100%; margin-bottom:1px; }
            html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
            html body td { vertical-align:top; text-align:left; }

            h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
            h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
            h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

            a { color:#005fce; text-decoration:none; }
            a:hover { color:#005fce; text-decoration:underline; }
            a:visited { color:#004aa0; text-decoration:none; }

            p { padding:0px; margin:0px 0px 20px; }
            img { padding:0px; margin:0px 0px 20px; border:none; }
            p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

            ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
            ul li { padding:0px; margin:0px 0px 7px 0px; }
            ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
            ul li ol li { list-style:decimal; }
            ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
            ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
            ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
            ol li ol li { list-style-type:lower-alpha; }
            ol li ul { padding-top:7px; }
            ol li ul li { list-style:square; }

            .content { font-size:1.2em; line-height:140%; padding: 20px; }

            pre, code { font-size:12px; }
            tt { font-size: 1.2em; }
            pre { margin:0px 0px 20px; }
            pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
            pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
            pre.error { color:red; }

            @media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

            span.keyword { color:#0000FF }
            span.comment { color:#228B22 }
            span.string { color:#A020F0 }
            span.untermstring { color:#B20000 }
            span.syscmd { color:#B28C00 }
            span.typesection { color:#A0522D }

            .footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
            .footer p { margin:0px; }
            .footer a { color:#878787; }
            .footer a:hover { color:#878787; text-decoration:underline; }
            .footer a:visited { color:#878787; }

            table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
            table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }

            .center {
                display: block;
                margin-left: auto;
                margin-right: auto;
                width: 50%;
              }



        </style></head><body><div class="content"><h1>COMPUTE AUTO INVARIANCE ERROR</h1><!--introduction--><!--/introduction--><pre class="codeinput"><span class="keyword">function</span> y = compute_auto_invariance_error(obj,W,R,rhosamp,orders,ntheta,varargin)
        </pre><p>This function calculates the invariance error measure for obtained SSM (and reduced dynamics on it). It is the average of residuals of the invariance equation evaluated at a collection of points on the SSM. This implementation only support 2D and 4D SSMs. For 2D SSM, the sampling points are given by</p><pre>  p = [rho*exp(i*theta_j) rho*exp(-i*theta_j)], 1&lt;=j&lt;ntheta</pre><p>where <tt>{\theta_j}</tt> follows a regular mesh. For 4D SSM, the samping points are given by</p><pre>   p = [rho_1*exp(i*theta^1_j) rho_1*exp(-i*theta^1_j)
        rho_2*exp(i*theta^2_k) rho_2*exp(-i*theta^2_k)]</pre><p>where <tt>rho_1= rho cos(alpha_i), rho_2=rho sin(alpha_i), 1&lt;=i&lt;=nalpha</tt></p><p>The errors will be computed at each radius in rhosamp and each expansion order in orders. The maximum element in orders should not be larger than the order of expansion in W and R.</p><p>Y = compute_auto_invariance_error(obj,W,R,rhosamp,orders,ntheta,varargin)</p><div><ul><li><tt>W</tt>: expansion of autonomous SSM</li></ul></div><div><ul><li><tt>R</tt>: expansion of reduced dynamics on SSM</li></ul></div><div><ul><li><tt>rhosamp</tt>: sampling radius for parameterization coordinates, at which error measures are computed</li></ul></div><div><ul><li><tt>orders</tt>: ordera at which invariance errors are computed</li></ul></div><div><ul><li><tt>ntheta</tt>: number of sample points along angle directions</li></ul></div><div><ul><li><tt>varargin</tt>: nalpha if the SSM is four-dimensional</li></ul></div><pre class="codeinput">dimSSM = obj.dimManifold;
norder = numel(orders);
nrho   = numel(rhosamp);
y      = zeros(norder,nrho);
theta  = linspace(0,2*pi,ntheta+1);
theta  = theta(1:end-1);
assert(max(orders)&lt;=numel(R), <span class="string">'Some requested expansion orders are higher than the approximation order of SSM'</span>);
assert(dimSSM==2||dimSSM==4, <span class="string">'Only support 2D and 4D SSMs'</span>);
<span class="keyword">if</span> dimSSM==4
    nalpha = varargin{1};
    alphas = linspace(0,pi/2,nalpha);
<span class="keyword">end</span>
<span class="comment">% loop over orders</span>
<span class="keyword">for</span> ko=1:norder
    orderk = orders(ko);
    Wk = W(1:orderk);
    Rk = R(1:orderk);
    <span class="comment">% loop over rhosamp</span>
    <span class="keyword">for</span> krho=1:nrho
        fprintf(<span class="string">'calculate error at order %d and rho=%d\n'</span>,orderk,rhosamp(krho));
        <span class="keyword">if</span> dimSSM==2
            <span class="comment">% construct sampling points</span>
            pj  = rhosamp(krho)*exp(1i*theta);
            <span class="comment">% evaluate residuals</span>
            res = obj.compuate_invariance_<a href="../../Library/DynamicalSystem/residual.html">residual</a>(Wk,Rk,pj,<span class="string">'auto'</span>);
        <span class="keyword">else</span>
            res = zeros(nalpha,ntheta,ntheta);
            <span class="comment">% construct sampling points</span>
            <span class="keyword">for</span> i=1:nalpha
                rho1 = rhosamp(krho)*cos(alphas(i));
                rho2 = rhosamp(krho)*sin(alphas(i));
                <span class="keyword">for</span> j=1:ntheta
                    p1 = rho1*exp(1i*theta(j))*ones(1,ntheta);
                    p3 = rho2*exp(1i*theta);
                    pij = [p1;conj(p1);p3;conj(p3)];
                    res(i,j,:) = obj.compuate_invariance_<a href="../../Library/DynamicalSystem/residual.html">residual</a>(Wk,Rk,pij,<span class="string">'auto'</span>);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
            res = res(:);
        <span class="keyword">end</span>
        <span class="comment">% record avearged residual</span>
        y(ko,krho) = mean(res);
    <span class="keyword">end</span>
<span class="keyword">end</span>
        </pre><pre class="codeinput"><span class="keyword">end</span>
        </pre><p class="footer"><br/><a href="https://www.mathworks.com/products/matlab/">Published with MATLABÂ® R2023a</a><br/></p></div><!--
            ##### SOURCE BEGIN #####
            %% COMPUTE AUTO INVARIANCE ERROR
%
%%
function y = compute_auto_invariance_error(obj,W,R,rhosamp,orders,ntheta,varargin)
%%
% This function calculates the invariance
% error measure for obtained SSM (and reduced dynamics on it). It is the
% average of residuals of the invariance equation evaluated at a collection
% of points on the SSM. This implementation only support 2D and 4D SSMs.
% For 2D SSM, the sampling points are given by
%
%    p = [rho*exp(i*theta_j) rho*exp(-i*theta_j)], 1<=j<ntheta
%
% where |{\theta_j}| follows a regular mesh.
% For 4D SSM, the samping points are given by
%
%     p = [rho_1*exp(i*theta^1_j) rho_1*exp(-i*theta^1_j)
%          rho_2*exp(i*theta^2_k) rho_2*exp(-i*theta^2_k)]
%
% where |rho_1= rho cos(alpha_i), rho_2=rho sin(alpha_i), 1<=i<=nalpha|
%
% The errors will be computed at each radius in rhosamp and each expansion
% order in orders. The maximum element in orders should not be larger than
% the order of expansion in W and R.
%
% Y = compute_auto_invariance_error(obj,W,R,rhosamp,orders,ntheta,varargin)
%
% * |W|: expansion of autonomous SSM
% 
% * |R|: expansion of reduced dynamics on SSM
% 
% * |rhosamp|: sampling radius for parameterization coordinates, at which error
% measures are computed
% 
% * |orders|: ordera at which invariance errors are computed
% 
% * |ntheta|: number of sample points along angle directions
% 
% * |varargin|: nalpha if the SSM is four-dimensional

dimSSM = obj.dimManifold;
norder = numel(orders);
nrho   = numel(rhosamp);
y      = zeros(norder,nrho);
theta  = linspace(0,2*pi,ntheta+1);
theta  = theta(1:end-1);
assert(max(orders)<=numel(R), 'Some requested expansion orders are higher than the approximation order of SSM');
assert(dimSSM==2||dimSSM==4, 'Only support 2D and 4D SSMs');
if dimSSM==4
    nalpha = varargin{1}; 
    alphas = linspace(0,pi/2,nalpha); 
end
% loop over orders
for ko=1:norder
    orderk = orders(ko);
    Wk = W(1:orderk);
    Rk = R(1:orderk);
    % loop over rhosamp
    for krho=1:nrho
        fprintf('calculate error at order %d and rho=%d\n',orderk,rhosamp(krho));
        if dimSSM==2
            % construct sampling points
            pj  = rhosamp(krho)*exp(1i*theta);
            % evaluate residuals
            res = obj.compuate_invariance_<a href="../../Library/DynamicalSystem/residual.html">residual</a>(Wk,Rk,pj,'auto');
        else
            res = zeros(nalpha,ntheta,ntheta);
            % construct sampling points
            for i=1:nalpha
                rho1 = rhosamp(krho)*cos(alphas(i));
                rho2 = rhosamp(krho)*sin(alphas(i));
                for j=1:ntheta
                    p1 = rho1*exp(1i*theta(j))*ones(1,ntheta);
                    p3 = rho2*exp(1i*theta);
                    pij = [p1;conj(p1);p3;conj(p3)];
                    res(i,j,:) = obj.compuate_invariance_<a href="../../Library/DynamicalSystem/residual.html">residual</a>(Wk,Rk,pij,'auto');
                end                
            end
            res = res(:);
        end
        % record avearged residual
        y(ko,krho) = mean(res);
    end
end

end
        
        
        
            ##### SOURCE END #####
        --></body></html></body></html>